---
description: é¡¹ç›®äº‹å®å¿«ç…§ - AI å¿…é¡»éµå®ˆçš„"ä¸å¯ç¼–é€ ç°å®"ï¼Œé˜²æ­¢ AI åèˆªæˆ–ç¼–é€ ä¸å­˜åœ¨çš„æŠ€æœ¯æ ˆ/API/ç±»
alwaysApply: true
globs:
---

# ğŸ“‹ é¡¹ç›®äº‹å®å¿«ç…§ï¼ˆAI çš„"ä¸å¯ç¼–é€ ç°å®"ï¼‰

> **é‡è¦**ï¼šä»¥ä¸‹ä¿¡æ¯ä»¥ä»“åº“çœŸå®ä»£ç ä¸ºå‡†ï¼ŒAI ä¸å¾—ç¼–é€ ä¸å­˜åœ¨çš„ç±»/æ–¹æ³•/é…ç½®ã€‚

---

## 1. äº§å“å®šä½ï¼ˆä¸å¯åç¦»ï¼‰

| é¡¹ç›® | äº‘ç«¯è‡ªä¹ å®¤ï¼ˆåŠ©å­¦ + è½»äº’åŠ¨ + ä½ç¤¾äº¤å‹åŠ›ï¼‰ |
|------|------------------------------------------|
| **è°ƒæ€§å…³é”®è¯** | æ¸©æš–ã€æ²»æ„ˆã€ç®€æ´ã€å®‰é™ã€ä¸“æ³¨ |
| **ç¦å¿Œ** | é«˜å¼ºåº¦ç¤¾äº¤ã€ç§èŠã€è¿‡åº¦æ‰“æ‰°ã€å¨±ä¹åŒ–è¿‡å¼º |

---

## 2. æŠ€æœ¯æ ˆä¸è¾¹ç•Œ

### 2.1 åç«¯
- **æ¡†æ¶**ï¼šSpring Boot `2.6.13`ï¼ˆè§ `pom.xml`ï¼‰
- **ORM**ï¼šMyBatis-Plus `3.5.3.1`
- **æ•°æ®åº“**ï¼šMySQL `8.x`ï¼Œæ•°æ®åº“å `study_room`
- **Java å…¼å®¹**ï¼šMaven ç¼–è¯‘ç›®æ ‡ `1.8`ï¼›è¿è¡Œç¯å¢ƒå¯ä¸º JDK 8/11/17

### 2.2 å‰ç«¯
- **æŠ€æœ¯**ï¼šçº¯ `HTML/CSS/JS`ï¼Œä½äº `src/main/resources/static/`
- **éƒ¨åˆ†é¡µé¢**ï¼šä½¿ç”¨ `Vue 3 CDN`ï¼ˆå¦‚ `focus.html`ã€`pet.html`ï¼‰
- **è®¾è®¡ç³»ç»Ÿ**ï¼š`css/variables.css` + `css/components.css`

### 2.3 é…ç½®
- **ç«¯å£**ï¼š`9090`ï¼ˆè§ `application.properties`ï¼‰
- **é‰´æƒ**ï¼šSession ç™»å½•ï¼ˆ`HttpSession` å†…å­˜ Sessionï¼Œç™»å½•åå†™å…¥ `session.setAttribute("user", user)`ï¼‰
- **é™æ€èµ„æº**ï¼šSpring Boot ç›´æ¥æ‰˜ç®¡ `static/` ä¸‹èµ„æº
- **æ•°æ®åº“åˆå§‹åŒ–**ï¼š`spring.sql.init.mode=always`ï¼Œè„šæœ¬ `classpath:schema.sql`ï¼Œ`continue-on-error=true`

---

## 3. å…³é”®ç›®å½•

| ç›®å½• | è¯´æ˜ |
|------|------|
| `src/main/java/com/example/qr_code/` | åç«¯ Java ä»£ç  |
| `â”œâ”€â”€ controller/` | æ§åˆ¶å™¨å±‚ |
| `â”œâ”€â”€ service/` | æœåŠ¡å±‚ |
| `â”œâ”€â”€ mapper/` | MyBatis Mapper |
| `â”œâ”€â”€ entity/` | å®ä½“ç±» |
| `â”œâ”€â”€ config/` | é…ç½®ç±» |
| `src/main/resources/static/` | å‰ç«¯é™æ€èµ„æº |
| `â”œâ”€â”€ css/variables.css` | CSS å˜é‡ï¼ˆè®¾è®¡ç³»ç»Ÿï¼‰ |
| `â”œâ”€â”€ css/components.css` | å…¬å…±ç»„ä»¶æ ·å¼ |
| `â”œâ”€â”€ js/nav.js` | å¯¼èˆªå…¬å…±é€»è¾‘ |
| `â”œâ”€â”€ js/pet-ai.js` | å® ç‰© AI é€»è¾‘ |
| `src/md/` | é¡¹ç›®æ–‡æ¡£ |
| `.codebuddy/rules/` | é¡¹ç›®è§„åˆ™ä¸ AI è¿è¡Œçº¦æŸ |
| `.codebuddy/config-templates/` | MCP æ¨¡æ¿ |

---

## 4. æ ¸å¿ƒé¡µé¢ï¼ˆå…¥å£æ¸…å•ï¼‰

| é¡µé¢ | åŠŸèƒ½ |
|------|------|
| `login.html` | ç™»å½• |
| `index.html` | è‡ªä¹ å®¤é¦–é¡µï¼ˆæ‰«ç å¼€é—¨ + åº§ä½çŠ¶æ€ + å¿«æ·å…¥å£ï¼‰ |
| `qrcode_scan.html` | æ‰«ç å¼€é—¨ |
| `seat.html` | åº§ä½ç®¡ç†ï¼ˆå åº§é€šç”µ/ç¦»åº§æ–­ç”µï¼‰ |
| `study.html` | å­¦ä¹ å°å±‹å…¥å£ |
| `focus.html` | ä¸“æ³¨ï¼ˆè‡ªç”±è®¡æ—¶/ç•ªèŒ„é’Ÿ + ç™½å™ªéŸ³ + æµ®åŠ¨å® ç‰©ï¼‰ |
| `pet.html` | å® ç‰© |
| `calendar.html` | ä»Šæ—¥å­¦ä¹ æ€»ç»“ |
| `stats.html` | ç»Ÿè®¡ï¼ˆEChartsï¼‰ |
| `message.html` | ç•™è¨€æ¿ï¼ˆå«æ–‡æ˜æç¤ºä¸æ²»ç†ï¼‰ |
| `encouragement.html` | æ¸©æš–ä¼ é€’ï¼ˆåŒ¿åé¼“åŠ±å¡ç‰‡ï¼‰ |
| `ranking.html` | æ’è¡Œæ¦œ |
| `reservation.html` | åº§ä½é¢„çº¦ |
| `admin.html` | ç®¡ç†åå° |

---

## 5. åç«¯ Controller æ¸…å•

| Controller | èŒè´£ |
|------------|------|
| `AdminController` | ç®¡ç†åå°æ¥å£ |
| `LoginController` | ç™»å½•/é€€å‡º |
| `UserController` | ç”¨æˆ·ä¿¡æ¯ |
| `SeatController` | åº§ä½åˆ—è¡¨ |
| `OrderController` | å…¥åº§/ç¦»åº§è®¢å• |
| `ReservationController` | åº§ä½é¢„çº¦ |
| `QrStatusController` | äºŒç»´ç æŠ¢å å¼é”å®šï¼ˆ3åˆ†é’Ÿï¼‰ |
| `FocusController` | ä¸“æ³¨è®°å½•/ä»Šæ—¥ç»Ÿè®¡/ä»Šæ—¥è¯¦æƒ… |
| `PetController` | å® ç‰©åˆ›å»º/è·å–/äº’åŠ¨/é¼“åŠ±è¯­ |
| `StatsController` | å‘¨/æœˆ/æ—¶æ®µ/ç”»åƒç»Ÿè®¡ |
| `MessageController` | ç•™è¨€æ¿ |
| `EncouragementController` | åŒ¿åé¼“åŠ±å¡ç‰‡ |
| `RankingController` | æ’è¡Œæ¦œ |
| `FileUploadController` | äºŒç»´ç å›¾ç‰‡ä¸Šä¼  |

---

## 6. æ•°æ®åº“å…³é”®è¡¨

| è¡¨å | è¯´æ˜ |
|------|------|
| `users` | ç”¨æˆ·è¡¨ |
| `seats` | åº§ä½è¡¨ |
| `orders` | å…¥åº§è®¢å•è¡¨ |
| `focus_records` | ä¸“æ³¨è®°å½•ï¼ˆ**å« `type`ï¼šfree/pomodoro**ï¼‰ |
| `learning_stats` | å­¦ä¹ ç»Ÿè®¡ï¼ˆ**å« `tomato_count`**ï¼‰ |
| `user_pets` | ç”¨æˆ·å® ç‰© |
| `access_logs` | è®¿é—®æ—¥å¿— |
| `seat_reservations` | åº§ä½é¢„çº¦ |
| `message_board` | ç•™è¨€æ¿ |
| `message_replies` | ç•™è¨€å›å¤ |
| `encouragement_cards` | é¼“åŠ±å¡ç‰‡ |
| `system_config` | ç³»ç»Ÿé…ç½® |

---

## 7. å¸¸ç”¨ API æ¥å£

### 7.1 ç™»å½•ä¸ç”¨æˆ·
- `POST /api/login`ï¼šç™»å½•ï¼ŒæˆåŠŸå session å†™å…¥ `user`
- `GET/POST /api/logout`ï¼šé€€å‡º
- `GET /api/user/info`ï¼šè·å–å½“å‰ç”¨æˆ·
- `GET /api/user/profile`ï¼šç”¨æˆ·è¯¦æƒ…

### 7.2 ä¸“æ³¨ä¸å® ç‰©
- `POST /api/focus/save`ï¼šä¿å­˜ä¸“æ³¨è®°å½•ï¼ŒBody: `{ "duration": ç§’, "type": "free"|"pomodoro" }`
- `GET /api/focus/today`ï¼šä»Šæ—¥ç»Ÿè®¡
- `GET /api/focus/today/details`ï¼šä»Šæ—¥è¯¦æƒ…ï¼ˆå« recordsï¼‰
- `GET /api/pet`ï¼šå® ç‰©ä¿¡æ¯

### 7.3 é—¨ç¦äºŒç»´ç 
- `POST /api/qr-status/lock`ï¼šé”å®š 3 åˆ†é’Ÿ
- `GET /api/qr-status/check`ï¼šæ£€æŸ¥é”å®šçŠ¶æ€

### 7.4 åº§ä½ä¸è®¢å•
- `GET /api/seats`ï¼šåº§ä½åˆ—è¡¨
- `POST /api/orders`ï¼šå…¥åº§åˆ›å»ºè®¢å•ï¼ˆé€šç”µï¼‰
- `PUT /api/orders/{id}/end`ï¼šç¦»åº§ç»“æŸè®¢å•ï¼ˆæ–­ç”µï¼‰

### 7.5 ç®¡ç†åå°
- `GET /api/admin/check`ï¼šç®¡ç†å‘˜æƒé™æ£€æŸ¥
- `GET /api/admin/users?withStats=true`ï¼šç”¨æˆ·åˆ—è¡¨ï¼ˆå«ç»Ÿè®¡ï¼‰
- `GET /api/admin/seats`ï¼šåº§ä½åˆ—è¡¨ï¼ˆå«ä½¿ç”¨è€…ï¼‰

---

## 8. API è¿”å›æ ¼å¼ç°çŠ¶

**å½“å‰**ï¼šController æ™®éä½¿ç”¨ `Map<String,Object>` è¿”å›

```json
{
  "success": true/false,
  "message": "string",
  "data": { ... }  // å­—æ®µä¸ç»Ÿä¸€ï¼ˆæœ‰çš„å« users/profile/order ç­‰ï¼‰
}
```

**ç»“è®º**ï¼šçŸ­æœŸå†…ä¸è¦å¼ºè¡Œå…¨ç«™åˆ‡åˆ° `{code,message,data}`ï¼Œé™¤éåŒæ—¶å®Œæˆï¼š
1. åç«¯å…¼å®¹å±‚ï¼ˆåŒæ—¶è¿”å› `success` å’Œ `code`ï¼‰
2. å‰ç«¯æ‰€æœ‰é¡µé¢çš„ fetch è§£æç»Ÿä¸€è¿ç§»

---

## 9. æ•°æ®åº“è¿ç§»ç­–ç•¥

- ä¼˜å…ˆä½¿ç”¨"å‘åå…¼å®¹"çš„å¢é‡å˜æ›´ï¼šæ–°å¢å­—æ®µè¦ç»™ DEFAULT
- å¿…é¡»åŒæ­¥ä¿®æ”¹ï¼š`schema.sql` ä¸ `sql/study_room_init.sql`
- å¦‚æœ `spring.sql.init.mode=always`ï¼Œç¡®ä¿è„šæœ¬å¯é‡å¤æ‰§è¡Œ
- **ä»»ä½•æ”¹è¡¨å¿…é¡»å†™å…¥**ï¼š
  - `src/md/core/03_CURRENT_STATUS_LOG.md`ï¼ˆçŠ¶æ€æ—¥å¿—ï¼‰
  - `src/md/deploy/15_DATABASE_CHANGELOG.md`ï¼ˆå˜æ›´æ—¥å¿—ï¼‰
- è¯¦ç»†è§„åˆ™å‚è§ï¼š`.codebuddy/rules/database-sync/rules/database-sync.mdc`

---

## 10. æ–‡æ¡£ç›®å½•ç»“æ„

```
src/md/
â”œâ”€â”€ README.md              # æ–‡æ¡£ç´¢å¼•
â”œâ”€â”€ core/                  # æ ¸å¿ƒè§„èŒƒï¼ˆAIè§„åˆ™ã€çŠ¶æ€æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ï¼‰
â”œâ”€â”€ design/                # è®¾è®¡æ–‡æ¡£ï¼ˆéœ€æ±‚ã€æ¶æ„ã€UIï¼‰
â”œâ”€â”€ guide/                 # å¼€å‘æŒ‡å—ï¼ˆä»»åŠ¡ä¹¦ã€å¼€å‘æŒ‡å—ï¼‰
â”œâ”€â”€ deploy/                # éƒ¨ç½²è¿ç§»ï¼ˆè¿ç§»æŒ‡å—ã€å˜æ›´æ—¥å¿—ï¼‰
â””â”€â”€ academic/              # å­¦æœ¯ç›¸å…³ï¼ˆè®ºæ–‡å¤§çº²ï¼‰
```

---

## 11. è¿ç§»éƒ¨ç½²ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `migrate_export.bat` | å¯¼å‡ºå½“å‰æ•°æ®åº“ï¼ˆç»“æ„+æ•°æ®ï¼‰ |
| `migrate_import.bat` | å¯¼å…¥åˆ°æ–°ç¯å¢ƒï¼ˆæ¸…ç©ºé‡å»ºï¼‰ |
| `src/md/deploy/14_MIGRATION_DEPLOY_GUIDE.md` | ä¸€é”®è¿ç§»éƒ¨ç½²æŒ‡å— |
| `src/md/deploy/15_DATABASE_CHANGELOG.md` | æ•°æ®åº“å˜æ›´æ—¥å¿— |
