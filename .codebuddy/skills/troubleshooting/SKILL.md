# 🔍 Skill: 问题诊断与排障 (Troubleshooting)

> **技能 ID**: `troubleshooting`
> **触发关键词**: 报错、bug、不工作、显示不对、崩溃、异常、失败、undefined、null、500、404

## 1. 技能职责

- 分析用户反馈的错误现象
- 定位问题根因（按概率排序）
- 给出最短验证路径
- 提供修复方案

## 2. 诊断流程

```
错误现象 → 信息收集 → 根因假设 → 验证路径 → 修复方案
```

### 信息收集清单

| 信息类型 | 获取方式 |
|---------|---------|
| 错误截图 | 用户提供 |
| 浏览器控制台 | F12 → Console |
| 网络请求 | F12 → Network |
| 后端日志 | 检查启动日志/控制台输出 |
| 相关代码 | 读取对应文件 |

## 3. 常见问题诊断模式

### 3.1 前端页面不显示数据

**检查顺序**：
1. 浏览器 Console 是否有 JS 错误
2. Network 中 API 请求是否成功（200）
3. API 返回数据格式是否正确
4. JS 代码是否正确解析数据
5. DOM 元素是否存在

**常见原因**：
- JS 语法错误导致脚本中断
- API 返回 `success: false`
- 数据字段名不匹配
- 用户未登录被拦截

### 3.2 后端接口报错

**检查顺序**：
1. 请求参数是否正确
2. Controller 路径是否匹配
3. Service 层逻辑是否有异常
4. 数据库查询是否正确
5. Session 是否有效

**常见原因**：
- 请求参数类型不匹配
- 空指针异常（NullPointerException）
- 数据库字段缺失
- 事务未正确回滚

### 3.3 数据库相关问题

**检查顺序**：
1. 表是否存在
2. 字段是否存在
3. SQL 语法是否正确
4. 连接是否正常
5. 数据是否存在

**常见原因**：
- schema.sql 未执行或执行失败
- 字段类型不匹配
- 外键约束冲突

## 4. 本项目常见坑

| 问题 | 原因 | 解决方案 |
|------|------|---------|
| JS 变量重复声明 | 多个脚本定义同名 const | 检查所有引入的 JS 文件 |
| API 返回数据不显示 | success=false 或字段名不对 | Console 打印完整响应 |
| 数据库字段缺失 | schema.sql 未更新 | 手动执行 ALTER TABLE |
| 专注记录不保存 | type 字段缺失 | 检查 focus_records 表结构 |

## 5. 诊断输出模板

```markdown
## 🔍 问题诊断报告

### 📌 问题现象
[描述用户反馈的问题]

### 🔎 信息收集
- **浏览器控制台**：[有/无错误]
- **网络请求**：[状态码/响应]
- **后端日志**：[有/无异常]

### 🎯 根因分析
1. **[主要原因]**：...

### 🛠️ 修复方案
[具体修复步骤]

### ✅ 验证方法
[如何验证问题已修复]
```
