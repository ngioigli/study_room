<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸ªäººä¸­å¿ƒ - äº‘ç«¯è‡ªä¹ å®¤</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: var(--font-family);
            background: var(--color-bg);
            min-height: 100vh;
            padding-bottom: 100px;
        }

        /* é¡¶éƒ¨åŒºåŸŸ */
        .header {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            padding: 60px var(--space-5) var(--space-8);
            position: relative;
        }

        .header-title {
            font-size: 17px;
            font-weight: 600;
            color: white;
            text-align: center;
            margin-bottom: var(--space-6);
        }

        /* ç”¨æˆ·å¡ç‰‡ */
        .user-card {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .user-avatar {
            width: 72px;
            height: 72px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .user-meta {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-card {
            background: white;
            border-radius: var(--radius-xl);
            margin: -30px var(--space-4) 0;
            padding: var(--space-5);
            box-shadow: var(--shadow-lg);
            position: relative;
            z-index: 10;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-4);
            text-align: center;
        }

        .stat-item {
            padding: var(--space-3);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        /* ä¸»å®¹å™¨ */
        .container {
            padding: var(--space-5) var(--space-4);
        }

        /* åŠŸèƒ½åˆ—è¡¨ */
        .menu-section {
            margin-bottom: var(--space-5);
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-3);
            padding-left: 4px;
        }

        .menu-list {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            border-bottom: 1px solid var(--color-border);
            text-decoration: none;
            color: var(--color-text-primary);
            transition: var(--transition-fast);
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: var(--color-card-bg);
        }

        .menu-item:active {
            background: var(--color-border);
        }

        .menu-icon {
            width: 36px;
            height: 36px;
            background: var(--color-card-bg);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .menu-content {
            flex: 1;
        }

        .menu-title {
            font-size: 15px;
            font-weight: 500;
        }

        .menu-desc {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-top: 2px;
        }

        .menu-arrow {
            color: var(--color-text-tertiary);
            font-size: 14px;
        }

        .menu-badge {
            background: var(--color-error);
            color: white;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            margin-right: var(--space-2);
        }

        /* é€€å‡ºæŒ‰é’® */
        .logout-btn {
            width: 100%;
            padding: var(--space-4);
            background: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 15px;
            color: var(--color-error);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .logout-btn:hover {
            background: #FEF2F2;
        }

        /* ç‰ˆæœ¬ä¿¡æ¯ */
        .version-info {
            text-align: center;
            padding: var(--space-6) 0;
            color: var(--color-text-tertiary);
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨åŒºåŸŸ -->
    <div class="header">
        <div class="header-title">ä¸ªäººä¸­å¿ƒ</div>
        <div class="user-card">
            <div class="user-avatar" id="userAvatar">ğŸ‘¤</div>
            <div class="user-info">
                <div class="user-name" id="userName">åŠ è½½ä¸­...</div>
                <div class="user-meta" id="userMeta">ç´¯è®¡å­¦ä¹  -- | Lv.--</div>
            </div>
        </div>
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-card">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="statDays">0</div>
                <div class="stat-label">è¿ç»­å­¦ä¹ </div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="statHours">0</div>
                <div class="stat-label">ç´¯è®¡æ—¶é•¿</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="statLevel">1</div>
                <div class="stat-label">å½“å‰ç­‰çº§</div>
            </div>
        </div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- å¸¸ç”¨åŠŸèƒ½ -->
        <div class="menu-section">
            <div class="section-title">å¸¸ç”¨åŠŸèƒ½</div>
            <div class="menu-list">
                <a href="stats.html" class="menu-item">
                    <div class="menu-icon">ğŸ“Š</div>
                    <div class="menu-content">
                        <div class="menu-title">å­¦ä¹ ç»Ÿè®¡</div>
                        <div class="menu-desc">æŸ¥çœ‹è¯¦ç»†å­¦ä¹ æ•°æ®</div>
                    </div>
                    <span class="menu-arrow">â€º</span>
                </a>
                <a href="pet.html" class="menu-item">
                    <div class="menu-icon">ğŸ±</div>
                    <div class="menu-content">
                        <div class="menu-title">æˆ‘çš„å® ç‰©</div>
                        <div class="menu-desc">æŸ¥çœ‹å® ç‰©è¯¦æƒ…</div>
                    </div>
                    <span class="menu-arrow">â€º</span>
                </a>
                <a href="#" class="menu-item" onclick="showMessage()">
                    <div class="menu-icon">ğŸ’¬</div>
                    <div class="menu-content">
                        <div class="menu-title">ç•™è¨€æ¿</div>
                        <div class="menu-desc">ç»™è‡ªä¹ å®¤ç•™è¨€</div>
                    </div>
                    <span class="menu-badge">New</span>
                    <span class="menu-arrow">â€º</span>
                </a>
            </div>
        </div>

        <!-- ç³»ç»Ÿè®¾ç½® -->
        <div class="menu-section">
            <div class="section-title">ç³»ç»Ÿè®¾ç½®</div>
            <div class="menu-list">
                <a href="#" class="menu-item" onclick="showSettings()">
                    <div class="menu-icon">âš™ï¸</div>
                    <div class="menu-content">
                        <div class="menu-title">è®¾ç½®</div>
                        <div class="menu-desc">é€šçŸ¥ã€éšç§ã€è´¦å·</div>
                    </div>
                    <span class="menu-arrow">â€º</span>
                </a>
                <a href="#" class="menu-item" onclick="showHelp()">
                    <div class="menu-icon">â“</div>
                    <div class="menu-content">
                        <div class="menu-title">å¸®åŠ©ä¸åé¦ˆ</div>
                        <div class="menu-desc">å¸¸è§é—®é¢˜ã€æ„è§åé¦ˆ</div>
                    </div>
                    <span class="menu-arrow">â€º</span>
                </a>
                <a href="#" class="menu-item" onclick="showAbout()">
                    <div class="menu-icon">â„¹ï¸</div>
                    <div class="menu-content">
                        <div class="menu-title">å…³äº</div>
                        <div class="menu-desc">ç‰ˆæœ¬ä¿¡æ¯ã€ç”¨æˆ·åè®®</div>
                    </div>
                    <span class="menu-arrow">â€º</span>
                </a>
            </div>
        </div>

        <!-- é€€å‡ºç™»å½• -->
        <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>

        <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
        <div class="version-info">
            äº‘ç«¯è‡ªä¹ å®¤ v2.0.0
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-label">è‡ªä¹ å®¤</span>
        </a>
        <a href="study.html" class="nav-item">
            <span class="nav-icon">ğŸ“š</span>
            <span class="nav-label">å­¦ä¹ å°å±‹</span>
        </a>
        <a href="member.html" class="nav-item">
            <span class="nav-icon">ğŸ‘‘</span>
            <span class="nav-label">ä¼šå‘˜</span>
        </a>
        <a href="profile.html" class="nav-item active">
            <span class="nav-icon">ğŸ‘¤</span>
            <span class="nav-label">æˆ‘çš„</span>
        </a>
    </nav>

    <script src="js/nav.js"></script>
    <script>
        // åŠ è½½ç”¨æˆ·ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', loadUserInfo);

        async function loadUserInfo() {
            try {
                // ä»åç«¯è·å–ç”¨æˆ·ä¿¡æ¯
                const res = await fetch('/api/user/info');
                const data = await res.json();
                
                if (data.success && data.user) {
                    const user = data.user;
                    document.getElementById('userName').textContent = user.nickname || user.username || 'å­¦ä¹ è€…';
                    localStorage.setItem('userInfo', JSON.stringify(user));
                } else {
                    // ä» localStorage è·å–å¤‡ç”¨ä¿¡æ¯
                    const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
                    document.getElementById('userName').textContent = userInfo.nickname || userInfo.username || 'å­¦ä¹ è€…';
                }
            } catch (err) {
                console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', err);
                const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
                document.getElementById('userName').textContent = userInfo.nickname || userInfo.username || 'å­¦ä¹ è€…';
            }
            
            // åŠ è½½ç»Ÿè®¡æ•°æ®
            loadStats();
        }

        async function loadStats() {
            try {
                // è·å–å­¦ä¹ ç»Ÿè®¡ - ä½¿ç”¨æ­£ç¡®çš„æ¥å£
                const [focusRes, statsRes] = await Promise.all([
                    fetch('/api/focus/today'),
                    fetch('/api/stats/weekly')
                ]);
                
                const focusData = await focusRes.json();
                const statsData = await statsRes.json();
                
                // ä»Šæ—¥æ•°æ®
                if (focusData.success) {
                    // å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ä»Šæ—¥æ•°æ®
                }
                
                // å‘¨ç»Ÿè®¡æ•°æ®
                if (statsData.success) {
                    const totalMinutes = statsData.totalMinutes || 0;
                    const hours = Math.floor(totalMinutes / 60);
                    document.getElementById('statHours').textContent = hours > 0 ? hours + 'h' : totalMinutes + 'åˆ†';
                }
                
                // è®¡ç®—è¿ç»­å­¦ä¹ å¤©æ•°
                if (statsData.success && statsData.dailyData) {
                    let streakDays = 0;
                    const dailyData = statsData.dailyData.slice().reverse(); // ä»ä»Šå¤©å¾€å‰æ•°
                    for (const day of dailyData) {
                        if (day.minutes > 0) {
                            streakDays++;
                        } else {
                            break;
                        }
                    }
                    document.getElementById('statDays').textContent = streakDays + 'å¤©';
                }
            } catch (err) {
                console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', err);
            }

            // è·å–å® ç‰©ç­‰çº§
            try {
                const petRes = await fetch('/api/pet');
                const petData = await petRes.json();
                
                if (petData.success && petData.hasPet) {
                    const pet = petData.pet;
                    document.getElementById('statLevel').textContent = pet.level || 1;
                    
                    // æ›´æ–°ç”¨æˆ·å…ƒä¿¡æ¯
                    const hours = document.getElementById('statHours').textContent;
                    document.getElementById('userMeta').textContent = 
                        `ç´¯è®¡å­¦ä¹  ${hours} | Lv.${pet.level || 1}`;
                } else {
                    document.getElementById('statLevel').textContent = 1;
                    const hours = document.getElementById('statHours').textContent;
                    document.getElementById('userMeta').textContent = `ç´¯è®¡å­¦ä¹  ${hours} | Lv.1`;
                }
            } catch (err) {
                console.error('åŠ è½½å® ç‰©å¤±è´¥:', err);
            }
        }

        function showMessage() {
            alert('ç•™è¨€æ¿åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showSettings() {
            alert('è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showHelp() {
            alert('å¸®åŠ©ä¸åé¦ˆåŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showAbout() {
            alert('äº‘ç«¯è‡ªä¹ å®¤ v2.0.0\n\nä¸€ä¸ªå¸®åŠ©ä½ ä¸“æ³¨å­¦ä¹ çš„è‡ªä¹ å®¤åº”ç”¨');
        }

        async function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                try {
                    await fetch('/api/logout', { method: 'POST' });
                } catch (err) {
                    console.error('é€€å‡ºç™»å½•å¤±è´¥:', err);
                }
                localStorage.removeItem('userInfo');
                localStorage.removeItem('token');
                window.location.href = '/login.html';
            }
        }
    </script>
</body>
</html>
