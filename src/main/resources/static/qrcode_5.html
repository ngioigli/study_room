<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å­¦ä¹ å°å±‹ - æ‰«ç å…¥åº§</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&family=Zeyada&display=swap" rel="stylesheet">
    <style>
        :root {
            --refresh-interval: 3s;
        }

        /* --- å…¨å±€åŸºç¡€æ ·å¼ --- */
        body, html {
            height: 100%;
            margin: 0;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background: #e0f7fa;
            overflow-x: hidden;
        }

        /* åŠ¨æ€èƒŒæ™¯ */
        .background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
            z-index: -1;
        }

        /* äº‘æœµåŠ¨ç”» */
        .cloud {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            opacity: 0.6;
            animation: float 35s infinite linear;
        }
        .cloud::after, .cloud::before {
            content: ''; position: absolute; background: inherit; border-radius: inherit;
        }
        .c1 { width: 100px; height: 40px; top: 10%; left: -10%; }
        .c1::after { width: 50px; height: 50px; top: -25px; left: 15px; }
        .c1::before { width: 40px; height: 40px; top: -15px; left: 45px; }
        .c2 { width: 120px; height: 50px; top: 80%; left: -20%; animation-duration: 45s; transform: scale(1.5); opacity: 0.4;}
        .c2::after { width: 60px; height: 60px; top: -30px; left: 20px; }
        .c2::before { width: 50px; height: 50px; top: -20px; left: 60px; }
        @keyframes float { from { left: -20%; } to { left: 120%; } }

        /* --- é¡¶éƒ¨æŒ‰é’®ç»„ (å·¦ä¸Šè§’éŸ³é¢‘ï¼Œå³ä¸Šè§’é€€å‡º) --- */

        /* 1. é€€å‡ºæŒ‰é’® (å³ä¸Šè§’) */
        #logoutBtn {
            position: absolute;
            top: 20px; right: 20px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            color: #57606f;
            cursor: pointer;
            font-family: inherit; font-size: 13px; font-weight: bold;
            transition: all 0.3s;
            backdrop-filter: blur(4px);
            z-index: 20;
        }
        #logoutBtn:hover { background: rgba(255, 255, 255, 0.9); }

        /* 2. ç™½å™ªéŸ³ç”µå°å®¹å™¨ (å·¦ä¸Šè§’) */
        .audio-player-container {
            position: absolute;
            top: 20px; left: 20px;
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 160px; /* é™åˆ¶å®½åº¦ */
        }

        /* æ’­æ”¾å™¨å¼€å…³ (æŠ˜å çŠ¶æ€) */
        .player-toggle {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            color: #57606f;
            cursor: pointer;
            font-size: 13px; font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(4px);
            transition: all 0.3s;
            width: fit-content;
        }
        .player-toggle:hover { background: rgba(255, 255, 255, 0.9); }
        .player-toggle.active { background: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }

        /* æ’­æ”¾å™¨é¢æ¿ (å±•å¼€çŠ¶æ€ - é»˜è®¤éšè—) */
        .player-panel {
            display: none; /* é»˜è®¤éšè— */
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: slideDown 0.3s ease;
        }
        .player-panel.show { display: block; }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å£°éŸ³æŒ‰é’®ç½‘æ ¼ */
        .sound-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .sound-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 12px;
            background: rgba(255,255,255,0.5);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sound-btn:hover { background: #fff; }

        /* æ¿€æ´»çŠ¶æ€ï¼šæ­£åœ¨æ’­æ”¾ */
        .sound-btn.playing {
            background: #e1f5fe;
            border-color: #81d4fa;
            color: #0277bd;
            box-shadow: inset 0 0 8px rgba(129, 212, 250, 0.3);
        }

        .sound-icon { font-size: 20px; margin-bottom: 4px; }
        .sound-name { font-size: 12px; font-weight: bold; }

        /* éŸ³é‡æ§åˆ¶ */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #7f8c8d;
        }
        .volume-slider {
            flex-grow: 1;
            height: 4px;
            -webkit-appearance: none;
            background: #dfe6e9;
            border-radius: 2px;
            outline: none;
        }
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px; height: 12px;
            background: #74b9ff;
            border-radius: 50%;
            cursor: pointer;
        }

        /* --- ä¸»å¸ƒå±€å®¹å™¨ --- */
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            /* é¡¶éƒ¨ç•™å‡ºæ›´å¤šç©ºé—´ç»™ä¸¤ä¸ªæŒ‰é’® */
            padding: 80px 20px 40px 20px;
            width: 100%;
            min-height: 100vh;
            box-sizing: border-box;
            position: relative;
        }

        /* --- äºŒç»´ç å¡ç‰‡ --- */
        #qrcode-container {
            width: 100%; max-width: 360px;
            padding: 25px;
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(137, 196, 244, 0.3);
            text-align: center;
            backdrop-filter: blur(10px);
            transition: transform 0.3s;
        }
        .header-text { font-size: 18px; font-weight: 700; color: #2c3e50; margin-bottom: 20px; letter-spacing: 1px; }
        .qrcode-image-wrapper {
            position: relative; width: 100%; padding-bottom: 100%; height: 0;
            border-radius: 16px; overflow: hidden; border: 4px solid #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        #qrcode-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .progress-bar {
            position: absolute; bottom: 0; left: 0; height: 4px; width: 100%;
            background: linear-gradient(90deg, #89f7fe, #66a6ff);
            transform-origin: left; animation: countdown var(--refresh-interval) linear infinite;
        }
        @keyframes countdown { from { transform: scaleX(1); } to { transform: scaleX(0); } }

        /* --- ç•™è¨€æ¿ --- */
        .blackboard {
            width: 100%; max-width: 360px;
            background: #404b69; border: 8px solid #a67c52;
            border-radius: 12px; padding: 20px; color: #f1f2f6; box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .blackboard h4 { font-size: 20px; margin: 0 0 15px 0; text-align: center; border-bottom: 1px dashed rgba(255,255,255,0.3); padding-bottom: 12px; font-weight: normal; letter-spacing: 2px; }
        .blackboard p { font-size: 14px; line-height: 1.8; white-space: pre-line; margin: 0; opacity: 0.9; }

        /* --- PCç«¯å¸ƒå±€é€‚é… --- */
        @media (min-width: 768px) {
            .main-container {
                flex-direction: row; justify-content: center; align-items: flex-start;
                gap: 60px; padding-top: 0; height: 100vh;
            }
            #qrcode-container { transform: rotate(-2deg); margin-top: 15vh;}
            #qrcode-container:hover { transform: rotate(0) scale(1.02); }
            .blackboard { width: 340px; transform: rotate(2deg); margin-top: calc(15vh + 20px); }
        }
    </style>
</head>
<body>

<div class="background">
    <div class="cloud c1"></div>
    <div class="cloud c2"></div>
</div>

<!-- å·¦ä¸Šè§’ï¼šç™½å™ªéŸ³ç”µå° -->
<div class="audio-player-container">
    <!-- 1. å¼€å…³æŒ‰é’® (é˜²è¯¯è§¦) -->
    <div class="player-toggle" onclick="togglePlayerPanel()">
        <span>ğŸ§ ä¸“æ³¨ç™½å™ªéŸ³</span>
        <span style="font-size: 10px;">â–¼</span>
    </div>

    <!-- 2. å±•å¼€çš„é¢æ¿ -->
    <div class="player-panel" id="playerPanel">
        <div class="sound-grid">
            <!-- å£°éŸ³ 1 -->
            <div class="sound-btn" onclick="toggleSound('rain', this)">
                <div class="sound-icon">ğŸŒ§ï¸</div>
                <div class="sound-name">é›¨è½å±‹æª</div>
            </div>
            <!-- å£°éŸ³ 2 -->
            <div class="sound-btn" onclick="toggleSound('fire', this)">
                <div class="sound-icon">ğŸ”¥</div>
                <div class="sound-name">å›´ç‚‰å¤œè¯</div>
            </div>
            <!-- å£°éŸ³ 3 -->
            <div class="sound-btn" onclick="toggleSound('forest', this)">
                <div class="sound-icon">ğŸŒ²</div>
                <div class="sound-name">æ¸…æ™¨æ£®æ—</div>
            </div>
            <!-- å£°éŸ³ 4 -->
            <div class="sound-btn" onclick="toggleSound('ocean', this)">
                <div class="sound-icon">ğŸŒŠ</div>
                <div class="sound-name">è¿œæ–¹æµ·æµª</div>
            </div>
        </div>

        <!-- æ€»éŸ³é‡æ§åˆ¶ -->
        <div class="volume-control">
            <span>ğŸ”ˆ</span>
            <input type="range" class="volume-slider" min="0" max="1" step="0.1" value="0.4" oninput="changeMasterVolume(this.value)">
            <span>ğŸ”Š</span>
        </div>
    </div>
</div>

<!-- å³ä¸Šè§’ï¼šç¦»åº§æŒ‰é’® -->
<button id="logoutBtn">ç¦»åº§ä¼‘æ¯</button>

<div class="main-container">
    <!-- äºŒç»´ç  -->
    <div id="qrcode-container">
        <h3 class="header-text">âœ¨ æ‰«ç è¿›å…¥å­¦ä¹ å°å±‹ âœ¨</h3>
        <div class="qrcode-image-wrapper">
            <img id="qrcode-image" src="/images/dynamic_qrcode.jpg" alt="äºŒç»´ç åŠ è½½ä¸­...">
            <div class="progress-bar"></div>
        </div>
    </div>

    <!-- ç•™è¨€æ¿ -->
    <div class="blackboard">
        <h4>ç•™è¨€æ¿</h4>
        <p>æ—¶å…‰ä¸è´Ÿèµ¶è·¯äººï¼Œäº¦ä¸è´Ÿä½ 
            å­¦é•¿å­¦å§ï¼Œæ„¿ä½ ä»¬å¾—å¿æ‰€æ„¿ï½
            ğŸŒ¸ğŸŒ¸ğŸŒ¸

            åº”å­¦é•¿å­¦å§éœ€æ±‚,æˆ‘è¿˜æ˜¯æŠŠç½‘ç«™æ­å»ºå›æ¥å•¦
            æ›´æ–°äº†ä¸€ç‰ˆ,ç•Œé¢ä¼˜åŒ–äº†ä¸€äº›,å¢åŠ äº†ç™½å™ªéŸ³çš„éŸ³ä¹æ’­æ”¾åŠŸèƒ½
            å­¦é•¿å­¦å§æœ‰å…¶ä»–éœ€æ±‚ç§ä¿¡æˆ‘,æˆ‘ä¼šä¸å®šæœŸæ›´æ–°ç½‘ç«™çš„
            å¸Œæœ›èƒ½ç»™å­¦é•¿å­¦å§æä¾›æ›´å¥½çš„æœåŠ¡â¤â¤â¤

            äºŒç»´ç æ˜¾ç¤ºå¤±æ•ˆ,è¯·è€å¿ƒç­‰å¾…3såˆ·æ–°é¡µé¢å†è¯•è¯•</p>
    </div>
</div>

<!-- éšè—çš„éŸ³é¢‘æ ‡ç­¾ -->
<audio id="audio-rain" src="/audio/rain.mp3" loop></audio>
<audio id="audio-fire" src="/audio/fire.mp3" loop></audio>
<audio id="audio-forest" src="/audio/forest.mp3" loop></audio>
<audio id="audio-ocean" src="/audio/ocean.mp3" loop></audio>

<script>
    // --- 1. åŠ¨æ€äºŒç»´ç é€»è¾‘ ---
    const REFRESH_INTERVAL_MS = 3000;

    function refreshQRCode() {
        const imgElement = document.getElementById('qrcode-image');
        if (imgElement) {
            const imageUrl = '/images/dynamic_qrcode.jpg?t=' + new Date().getTime();
            imgElement.src = imageUrl;
        }
    }
    refreshQRCode();
    setInterval(refreshQRCode, REFRESH_INTERVAL_MS);

    // --- 2. é€€å‡ºç™»å½•é€»è¾‘ ---
    document.getElementById('logoutBtn').addEventListener('click', function() {
        if(confirm('å­¦ç´¯äº†å—ï¼Ÿç¡®å®šè¦ç¦»åº§ä¼‘æ¯ä¸€ä¸‹å—ï¼Ÿ\nä½ç½®ä¼šä¸€ç›´ä¸ºä½ ç•™ç€å“’~')) {
            fetch('/api/logout').then(() => { window.location.href = '/login.html'; });
        }
    });

    // --- 3. ç™½å™ªéŸ³ç”µå°é€»è¾‘ ---

    // å±•å¼€/æ”¶èµ·é¢æ¿
    function togglePlayerPanel() {
        const panel = document.getElementById('playerPanel');
        const toggleBtn = document.querySelector('.player-toggle');

        if (panel.style.display === 'block') {
            panel.style.display = 'none';
            toggleBtn.classList.remove('active');
            toggleBtn.querySelector('span:last-child').innerText = 'â–¼';
        } else {
            panel.style.display = 'block';
            toggleBtn.classList.add('active');
            toggleBtn.querySelector('span:last-child').innerText = 'â–²';
        }
    }

    // åˆ‡æ¢å£°éŸ³æ’­æ”¾/æš‚åœ (æ”¯æŒæ··åˆæ’­æ”¾)
    let masterVolume = 0.4; // é»˜è®¤éŸ³é‡

    function toggleSound(soundName, btnElement) {
        const audio = document.getElementById('audio-' + soundName);

        if (audio.paused) {
            // å¼€å§‹æ’­æ”¾
            audio.volume = masterVolume;
            audio.play();
            btnElement.classList.add('playing');
        } else {
            // åœæ­¢æ’­æ”¾
            audio.pause();
            // å½’é›¶è¿›åº¦ï¼Œä¸‹æ¬¡ä»å¤´æ’­æ”¾ï¼ˆå¯é€‰ï¼‰
            audio.currentTime = 0;
            btnElement.classList.remove('playing');
        }
    }

    // è°ƒèŠ‚æ€»éŸ³é‡
    function changeMasterVolume(value) {
        masterVolume = value;
        const audios = document.querySelectorAll('audio');
        audios.forEach(audio => {
            // åªæœ‰æ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘æ‰éœ€è¦å®æ—¶è°ƒæ•´éŸ³é‡
            if (!audio.paused) {
                audio.volume = masterVolume;
            }
        });
    }
</script>

</body>
</html>