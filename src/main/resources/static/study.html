<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å­¦ä¹ å°å±‹ - äº‘ç«¯è‡ªä¹ å®¤</title>
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/components.css">
    <style>
        body {
            background: var(--gradient-warm);
            min-height: 100vh;
        }

        .page-container {
            padding: var(--space-5);
            padding-bottom: calc(var(--nav-height) + var(--space-6));
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            text-align: center;
            margin-bottom: var(--space-6);
        }

        .page-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-dark);
            margin-bottom: var(--space-2);
        }

        .page-subtitle {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        /* ä¸“æ³¨å…¥å£å¤§æŒ‰é’® */
        .focus-entry-card {
            background: var(--gradient-primary);
            border-radius: var(--radius-xl);
            padding: var(--space-8) var(--space-6);
            text-align: center;
            color: #fff;
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-card);
            cursor: pointer;
            transition: var(--transition-normal);
            text-decoration: none;
            display: block;
        }

        .focus-entry-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(124, 58, 237, 0.25);
        }

        .focus-entry-card:active {
            transform: translateY(-2px);
        }

        .focus-entry-icon {
            font-size: 56px;
            margin-bottom: var(--space-4);
            display: block;
        }

        .focus-entry-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-2);
        }

        .focus-entry-desc {
            font-size: var(--font-size-sm);
            opacity: 0.9;
        }

        /* ä»Šæ—¥æ•°æ® */
        .today-stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
        }

        .today-stat {
            text-align: center;
        }

        .today-stat-value {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
        }

        .today-stat-label {
            font-size: var(--font-size-xs);
            opacity: 0.8;
            margin-top: 2px;
        }

        /* å·¥å…·åŒºå— */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .section-title {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-secondary);
        }

        /* å·¥å…·ç½‘æ ¼ */
        .tool-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
        }

        .tool-card {
            background: #fff;
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-3);
            text-decoration: none;
            color: var(--color-text-primary);
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
        }

        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .tool-card:active {
            transform: translateY(-2px);
        }

        .tool-icon {
            width: 56px;
            height: 56px;
            background: var(--color-card-bg);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .tool-card:nth-child(1) .tool-icon { background: #FEF3C7; }
        .tool-card:nth-child(2) .tool-icon { background: #DBEAFE; }
        .tool-card:nth-child(3) .tool-icon { background: #FCE7F3; }
        .tool-card:nth-child(4) .tool-icon { background: #D1FAE5; }
        .tool-card:nth-child(5) .tool-icon { background: #FEE2E2; }
        .tool-card:nth-child(6) .tool-icon { background: #E0E7FF; }

        .tool-label {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
        }

        .tool-desc {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            text-align: center;
        }

        /* å® ç‰©é¢„è§ˆå¡ç‰‡ */
        .pet-preview-card {
            background: #fff;
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            margin-top: var(--space-6);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: var(--space-4);
            cursor: pointer;
            transition: var(--transition-normal);
            text-decoration: none;
            color: inherit;
        }

        .pet-preview-card:hover {
            box-shadow: var(--shadow-md);
        }

        .pet-preview-avatar {
            width: 64px;
            height: 64px;
            background: var(--color-card-bg);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }

        .pet-preview-info {
            flex: 1;
        }

        .pet-preview-name {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-dark);
            margin-bottom: var(--space-1);
        }

        .pet-preview-level {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .pet-preview-arrow {
            font-size: 20px;
            color: var(--color-text-tertiary);
        }

        /* ç»éªŒæ¡ */
        .pet-exp-bar {
            margin-top: var(--space-2);
            height: 6px;
            background: var(--color-divider);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .pet-exp-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="page-container page-with-nav">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="page-title">å­¦ä¹ å°å±‹ ğŸ“š</h1>
            <p class="page-subtitle">ä¸“æ³¨å­¦ä¹ ï¼Œå¿«ä¹æˆé•¿</p>
        </div>

        <!-- ä¸“æ³¨å…¥å£ -->
        <a href="/focus.html" class="focus-entry-card">
            <span class="focus-entry-icon">ğŸ¯</span>
            <div class="focus-entry-title">å¼€å§‹ä¸“æ³¨</div>
            <div class="focus-entry-desc">è¿›å…¥æ²‰æµ¸å¼ä¸“æ³¨ç©ºé—´ï¼Œå® ç‰©é™ªä¼´å­¦ä¹ </div>
            
            <div class="today-stats">
                <div class="today-stat">
                    <div class="today-stat-value" id="todayDuration">--</div>
                    <div class="today-stat-label">ä»Šæ—¥å­¦ä¹ </div>
                </div>
                <div class="today-stat">
                    <div class="today-stat-value" id="todayCount">-</div>
                    <div class="today-stat-label">ä¸“æ³¨æ¬¡æ•°</div>
                </div>
                <div class="today-stat">
                    <div class="today-stat-value" id="todayExp">-</div>
                    <div class="today-stat-label">è·å¾—ç»éªŒ</div>
                </div>
            </div>
        </a>

        <!-- å­¦ä¹ å·¥å…· -->
        <div class="section-header">
            <span class="section-title">å­¦ä¹ å·¥å…·</span>
        </div>

        <div class="tool-grid">
            <a href="/calendar.html" class="tool-card">
                <div class="tool-icon">ğŸ“…</div>
                <span class="tool-label">å­¦ä¹ æ—¥å†</span>
                <span class="tool-desc">æ‰“å¡è®°å½•</span>
            </a>
            <a href="/encouragement.html" class="tool-card">
                <div class="tool-icon">ğŸ’Œ</div>
                <span class="tool-label">æ¸©æš–ä¼ é€’</span>
                <span class="tool-desc">åŒ¿åé¼“åŠ±</span>
            </a>
            <a href="/shredder.html" class="tool-card">
                <div class="tool-icon">ğŸ“</div>
                <span class="tool-label">æƒ…ç»ªç¢çº¸æœº</span>
                <span class="tool-desc">é‡Šæ”¾å‹åŠ›</span>
            </a>
            <a href="/stats.html" class="tool-card">
                <div class="tool-icon">ğŸ“Š</div>
                <span class="tool-label">å­¦ä¹ ç»Ÿè®¡</span>
                <span class="tool-desc">æ•°æ®åˆ†æ</span>
            </a>
        </div>

        <!-- å® ç‰©é¢„è§ˆ -->
        <a href="/pet.html" class="pet-preview-card">
            <div class="pet-preview-avatar" id="petAvatar">ğŸ±</div>
            <div class="pet-preview-info">
                <div class="pet-preview-name" id="petName">æˆ‘çš„å® ç‰©</div>
                <div class="pet-preview-level" id="petLevel">Lv.1 Â· å¹¼å¹´ä½“</div>
                <div class="pet-exp-bar">
                    <div class="pet-exp-fill" id="petExpFill" style="width: 0%"></div>
                </div>
            </div>
            <span class="pet-preview-arrow">â€º</span>
        </a>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <nav class="bottom-nav">
        <a href="/index.html" class="nav-item">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-label">è‡ªä¹ å®¤</span>
        </a>
        <a href="/study.html" class="nav-item active">
            <span class="nav-icon">ğŸ“š</span>
            <span class="nav-label">å­¦ä¹ å°å±‹</span>
        </a>
        <a href="/member.html" class="nav-item">
            <span class="nav-icon">ğŸ‘‘</span>
            <span class="nav-label">ä¼šå‘˜</span>
        </a>
        <a href="/profile.html" class="nav-item">
            <span class="nav-icon">ğŸ‘¤</span>
            <span class="nav-label">æˆ‘çš„</span>
        </a>
    </nav>

    <script src="/js/nav.js"></script>
    <script src="/js/pet-ai.js"></script>
    <script>
        // å® ç‰© Emoji æ˜ å°„
        const PET_EMOJIS = {
            cat: { egg: 'ğŸ¥š', baby: 'ğŸ±', teen: 'ğŸ˜º', adult: 'ğŸ˜¸', professional: 'ğŸ“ğŸ˜¸' },
            dog: { egg: 'ğŸ¥š', baby: 'ğŸ¶', teen: 'ğŸ•', adult: 'ğŸ¦®', professional: 'ğŸ“ğŸ¶' },
            rabbit: { egg: 'ğŸ¥š', baby: 'ğŸ°', teen: 'ğŸ‡', adult: 'ğŸ‡', professional: 'ğŸ“ğŸ°' }
        };

        const STAGE_NAMES = {
            egg: 'è›‹',
            baby: 'å¹¼å¹´ä½“',
            teen: 'å°‘å¹´ä½“',
            adult: 'æˆå¹´ä½“',
            professional: 'èŒä¸šå½¢æ€'
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadTodayStats();
            loadPetInfo();
        });

        // æ ¼å¼åŒ–æ—¶é•¿ï¼ˆç§’è½¬ä¸ºå¯è¯»æ ¼å¼ï¼‰
        function formatDuration(seconds) {
            if (!seconds || seconds <= 0) return '0åˆ†';
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            if (hours > 0) {
                return minutes > 0 ? `${hours}h${minutes}m` : `${hours}h`;
            }
            return `${minutes}åˆ†`;
        }

        // åŠ è½½ä»Šæ—¥ç»Ÿè®¡
        async function loadTodayStats() {
            try {
                const res = await fetch('/api/focus/today');
                const data = await res.json();
                if (data.success) {
                    document.getElementById('todayDuration').textContent = formatDuration(data.totalDuration || 0);
                    document.getElementById('todayCount').textContent = data.focusCount || 0;
                    document.getElementById('todayExp').textContent = data.expEarned || 0;
                }
            } catch (err) {
                console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', err);
            }
        }

        // åŠ è½½å® ç‰©ä¿¡æ¯
        async function loadPetInfo() {
            try {
                const res = await fetch('/api/pet');
                const data = await res.json();
                
                if (data.success && data.hasPet) {
                    const pet = data.pet;
                    const type = pet.type || 'cat';
                    const stage = pet.stage || 'baby';
                    const emojis = PET_EMOJIS[type] || PET_EMOJIS.cat;
                    
                    document.getElementById('petAvatar').textContent = emojis[stage] || emojis.baby;
                    document.getElementById('petName').textContent = pet.name || 'æˆ‘çš„å® ç‰©';
                    document.getElementById('petLevel').textContent = `Lv.${pet.level || 1} Â· ${STAGE_NAMES[stage] || 'å¹¼å¹´ä½“'}`;
                    
                    const expPercent = ((pet.exp || 0) % 100);
                    document.getElementById('petExpFill').style.width = `${expPercent}%`;
                } else {
                    document.getElementById('petAvatar').textContent = 'ğŸ¥š';
                    document.getElementById('petName').textContent = 'é¢†å…»å® ç‰©';
                    document.getElementById('petLevel').textContent = 'ç‚¹å‡»é¢†å…»ä½ çš„ä¸“å±ä¼™ä¼´';
                }
            } catch (err) {
                console.error('åŠ è½½å® ç‰©ä¿¡æ¯å¤±è´¥:', err);
            }
        }
    </script>
</body>
</html>
