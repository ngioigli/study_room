# 毕业设计方案拟定图表描述 (Mermaid/逻辑图)

本文件提供了课题开题报告中所需的关键逻辑图表描述。你可以将这些 Mermaid 代码复制到支持 Mermaid 的编辑器中（如 Notion, Obsidian, GitHub 等）直接生成图片，或者作为绘图参考。

---

## 1. 核心业务流程图 (Business Workflow)
描述用户从进入自习室到离开的完整生命周期。

```mermaid
graph TD
    A[用户到达门口] --> B{是否有预约/余额?}
    B -- 否 --> C[提示充值/预约]
    B -- 是 --> D[点击手机端扫码入座]
    D --> E{资源是否空闲?}
    E -- 否 --> F[显示通道占用, 进入排队倒计时]
    E -- 是 --> G[触发原子化锁定, 倒计时3分钟]
    G --> H[展示清晰二维码]
    H --> I[线下硬件/扫码枪识别]
    I --> J[门禁开启, 用户通行]
    J --> K[入座开启专注模式]
    K --> L[学习结束, 离座结算]
    L --> M[宠物获得经验/统计更新]
```

---

## 2. 系统总体架构图 (System Architecture)
描述软硬协同的四层架构设计。

```mermaid
graph TB
    subgraph 用户终端层
        Mobile[移动端 Web/H5]
        Admin[管理后台 Web]
    end

    subgraph 采集与硬件模拟层
        Python[Python 采集客户端]
        HW[硬件门禁/模拟器]
    end

    subgraph 业务服务层
        Server[Spring Boot 核心服务]
        Auth[鉴权拦截器]
        Logic[原子化锁定状态机]
    end

    subgraph 数据存储层
        DB[(MySQL 8.0)]
    end

    Mobile <--> Server
    Admin <--> Server
    Python -- 图像压缩上传 --> Server
    Server -- 状态指令 --> Python
    Server <--> DB
```

---

## 3. 数据库 ER 关系图 (Database ERD)
展示核心实体的关联关系。

```mermaid
erDiagram
    USER ||--o{ FOCUS_RECORD : "产生"
    USER ||--o1 USER_PET : "拥有"
    USER ||--o{ MESSAGE_BOARD : "发布"
    USER ||--o{ SEAT_RESERVATION : "预约"
    SEAT ||--o{ SEAT_RESERVATION : "被预约"
    MESSAGE_BOARD ||--o{ MESSAGE_REPLY : "包含"
    
    USER {
        bigint id PK
        string username
        int study_days
    }
    FOCUS_RECORD {
        bigint id PK
        bigint user_id FK
        int duration
        string type
    }
    SEAT {
        bigint id PK
        string seat_code
        int status
    }
```

---

## 4. 核心算法：原子化通行窗口时序图 (Sequence Diagram)
展示“抢占式锁定”在并发环境下的逻辑表现。

```mermaid
sequenceDiagram
    participant U1 as 用户 A (手机)
    participant U2 as 用户 B (手机)
    participant S as Java 服务端
    participant DB as 数据库/状态机

    U1->>S: 请求锁定 (lock)
    U2->>S: 请求锁定 (lock)
    Note over S: 几乎同时到达
    S->>DB: UPDATE status=1 WHERE status=0
    DB-->>S: 影响行数: 1 (成功)
    S-->>U1: 返回: 锁定成功, 展示二维码
    
    S->>DB: UPDATE status=1 WHERE status=0
    DB-->>S: 影响行数: 0 (失败)
    S-->>U2: 返回: 锁定失败, 显示占用中
```

---

## 5. 论文引用说明 (建议)
在论文中引用上述图表时，可搭配以下文字：
- **图1 (业务流程)**：展示了系统如何通过软件预锁定的方式，将物理空间的排队行为前置到逻辑层，降低了硬件冲突的概率。
- **图4 (算法时序)**：体现了“抢占式”设计的原子性。通过数据库行锁或原子更新，确保了在 180 秒的通行窗口内，资源分配的唯一性和安全性。
