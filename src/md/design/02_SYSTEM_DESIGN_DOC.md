# 系统设计文档 (System Design Document)

**更新日期**: 2026-01-20
**当前版本**: v3.0 (HTML + Spring Boot 整合版)

---

## 1. 系统架构概述

### 1.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   浏览器     │  │   手机端    │  │   Python 客户端     │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘  │
└─────────┼────────────────┼────────────────────┼─────────────┘
          │                │                    │
          ▼                ▼                    ▼
┌─────────────────────────────────────────────────────────────┐
│                       前端层                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  纯 HTML/CSS/JavaScript (src/main/resources/static/)│   │
│  │  - 响应式设计，适配 Mobile/Desktop                   │   │
│  │  - 部分页面使用 Vue 3 CDN 模式                      │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       后端层                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  Spring Boot 2.6.13 (端口: 9090)                     │   │
│  │  - 核心业务：登录、专注、宠物、统计、座位、二维码      │   │
│  │  - 静态资源托管：直接服务 static 目录下的文件         │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       数据层                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  MySQL 8.x (数据库: study_room)                      │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 技术栈

| 层级 | 技术 | 版本 | 说明 |
|------|------|------|------|
| 前端 | HTML5/CSS3/JS | - | 核心基础 |
| 前端 | Vue 3 (CDN) | 3.x | 部分页面交互逻辑 (focus.html, pet.html) |
| 前端 | ECharts | 5.x | 数据可视化 (stats.html) |
| 后端 | Spring Boot | 2.6.13 | Web 框架 |
| 后端 | MyBatis-Plus | 3.5.3.1 | ORM 框架 |
| 数据库 | MySQL | 8.x | 关系型数据库 |
| 运行时 | JDK | 17 | Java 运行环境 |


---

## 2. 前端设计与实现

### 2.1 目录结构

```
src/main/resources/static/
├── *.html              # 页面入口
├── css/                # 样式系统
│   ├── variables.css   # 设计变量
│   ├── components.css  # 公共组件
│   └── pet-sprites.css # 宠物动画
├── js/                 # 核心逻辑
│   ├── nav.js          # 导航与路由
│   └── pet-ai.js       # 宠物行为逻辑
├── audio/              # 白噪音音频
└── images/             # 静态图片
```

### 2.2 核心页面清单

| 页面文件 | 功能 | 技术特点 |
|----------|------|---------|
| `login.html` | 登录 | 动态云朵背景 |
| `index.html` | 首页 | 实时座位状态、扫码入口 |
| `study.html` | 学习中心 | 模块化导航网格 |
| `focus.html` | 专注模式 | Vue 3 CDN, 计时器, 白噪音混音 |
| `pet.html` | 宠物系统 | Vue 3 CDN, 实时互动, 经验条 |
| `shredder.html`| 情绪碎纸机 | Canvas/CSS 动画, 历史记录 |
| `stats.html` | 统计 | ECharts 图表 |
| `admin.html` | 管理后台 | 实时监控、数据看板 |


---

## 3. 后端 API 设计

### 3.1 API 端点列表

#### 认证相关
| 方法 | 端点 | 功能 |
|------|------|------|
| POST | `/api/login` | 用户登录 |
| GET | `/api/logout` | 用户登出 |

#### 专注记录
| 方法 | 端点 | 功能 |
|------|------|------|
| POST | `/api/focus/save` | 保存专注记录 |
| GET | `/api/focus/today` | 获取今日统计 |

#### 宠物系统
| 方法 | 端点 | 功能 |
|------|------|------|
| GET | `/api/pet` | 获取宠物信息 |
| POST | `/api/pet/create` | 创建宠物 |
| POST | `/api/pet/interact` | 宠物互动 |
| GET | `/api/pet/message` | 获取随机鼓励语 |
| POST | `/api/pet/instant-hatch` | 一键孵化（测试） |

#### 学习统计
| 方法 | 端点 | 功能 |
|------|------|------|
| GET | `/api/stats/weekly` | 获取周统计 |
| GET | `/api/stats/monthly` | 获取月统计 |
| GET | `/api/stats/hourly` | 获取时段分布 |
| GET | `/api/stats/profile` | 获取学习画像 |

#### 二维码状态
| 方法 | 端点 | 功能 |
|------|------|------|
| GET | `/api/qr-status/check` | 检查锁定状态 |
| POST | `/api/qr-status/lock` | 锁定二维码 |

---

## 4. 数据库设计

### 4.1 ER 图

```
┌─────────────┐       ┌─────────────────┐       ┌─────────────────┐
│   users     │       │  focus_records  │       │  learning_stats │
├─────────────┤       ├─────────────────┤       ├─────────────────┤
│ id (PK)     │◄──────│ user_id (FK)    │       │ id (PK)         │
│ username    │       │ id (PK)         │       │ user_id (FK)    │
│ password    │       │ duration        │       │ total_duration  │
│ created_at  │       │ exp_gained      │       │ total_sessions  │
└─────────────┘       │ created_at      │       │ streak_days     │
      │               └─────────────────┘       └─────────────────┘
      │
      ▼
┌─────────────┐       ┌─────────────────┐
│  user_pets  │       │     seats       │
├─────────────┤       ├─────────────────┤
│ id (PK)     │       │ id (PK)         │
│ user_id (FK)│       │ seat_code       │
│ name        │       │ status          │
│ type        │       │ user_id (FK)    │
│ level       │       └─────────────────┘
│ exp         │
│ mood        │
│ stage       │
└─────────────┘
```

### 4.2 表结构

详见 `src/main/resources/sql/study_room_init.sql`

---

## 5. 部署架构

### 5.1 开发环境

```
┌──────────────────┐     ┌──────────────────┐
│  Vue Dev Server  │────▶│  Spring Boot     │
│  localhost:5173  │     │  localhost:9090  │
└──────────────────┘     └──────────────────┘
        │                        │
        │  Vite Proxy            │
        │  /api/* ──────────────▶│
        │                        │
                                 ▼
                        ┌──────────────────┐
                        │     MySQL        │
                        │  localhost:3306  │
                        └──────────────────┘
```

### 5.2 生产环境

```
┌──────────────────────────────────────────┐
│           Spring Boot (9090)              │
│  ┌────────────────────────────────────┐  │
│  │  /static/** → 直接映射至 static 目录   │  │
│  │  /api/**    → 后端核心业务接口         │  │
│  └────────────────────────────────────┘  │
└──────────────────────────────────────────┘
                    │
                    ▼
           ┌──────────────────┐
           │     MySQL        │
           └──────────────────┘
```


---

*End of System Design Document*
